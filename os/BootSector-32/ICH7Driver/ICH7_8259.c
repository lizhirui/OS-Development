#include "../common.h"
#include "ICH7_8259.h"
#include "../PCI.h"

PCI_DEVICE ICH7_8259_DEV;

void ICH7_8259_Init()
{
	ICH7_8259_DEV.Bus = 0;
	ICH7_8259_DEV.Device = 31;
	ICH7_8259_DEV.Function = 0;
	//主8259初始化
	IO_Out8(ICH7_8259_MASTER_ICW1,0x11);
	IO_Out8(ICH7_8259_MASTER_ICW2,0x08);
	IO_Out8(ICH7_8259_MASTER_ICW3,0x04);
	IO_Out8(ICH7_8259_MASTER_ICW4,0x01);
	//从8259初始化
	IO_Out8(ICH7_8259_SLAVE_ICW1,0x11);
	IO_Out8(ICH7_8259_SLAVE_ICW2,0x70);
	IO_Out8(ICH7_8259_SLAVE_ICW3,0x02);
	IO_Out8(ICH7_8259_SLAVE_ICW4,0x01);
	//主8259配置
	IO_Out8(ICH7_8259_MASTER_OCW1,0xFE);
	IO_Out8(ICH7_8259_MASTER_OCW2,0x20);
	//从8259配置
	IO_Out8(ICH7_8259_SLAVE_OCW1,0xFF);
	IO_Out8(ICH7_8259_SLAVE_OCW2,0x20);
}

void ICH7_8259_Master_Handler_End()
{
	IO_Out8(ICH7_8259_MASTER_OCW2,0x20);
}

void ICH7_8259_Slave_Handler_End()
{
	IO_Out8(ICH7_8259_SLAVE_OCW2,0x20);
}